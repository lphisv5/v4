<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fortnite Shop</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: #0c0c0c;
    color: #fff;
    overflow-x: hidden;
    position: relative;
  }

  header {
    padding: 1rem;
    text-align: center;
    background: #111;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }

  h1 {
    margin: 0;
    font-size: 2rem;
    letter-spacing: 2px;
    color: #ffdd57;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    flex-wrap: wrap;
    background: #111;
    position: relative;
    z-index: 11;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }

  .search-container {
    position: relative;
    display: flex;
    align-items: center;
  }

  .search-container i {
    position: absolute;
    left: 12px;
    color: #777;
  }

  input, select {
    padding: 0.7rem 1rem 0.7rem 35px;
    border-radius: 12px;
    border: none;
    outline: none;
    font-size: 1rem;
    background: #1c1c1c;
    color: #fff;
    transition: all 0.3s ease;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
  }

  input:focus, select:focus,
  input:hover, select:hover {
    box-shadow: 0 0 15px #00ffe7;
    animation: glowPulse 1.5s infinite alternate;
  }

  @keyframes glowPulse {
    from { box-shadow: 0 0 10px #00ffe7; }
    to { box-shadow: 0 0 25px #00ffe7; }
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    padding: 1.5rem;
    position: relative;
    z-index: 11;
  }

  /* Card style - ปรับปรุงให้เป็น 3D */
  .card {
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    transform: scale(0.95);
    opacity: 0;
    animation: fadeInScale 0.6s forwards;
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                box-shadow 0.5s ease,
                filter 0.5s ease;
    perspective: 1000px;
    position: relative;
    transform-style: preserve-3d;
    filter: brightness(0.95);
  }

  .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.5s ease;
  }

  .card img {
    width: 100%;
    height: 220px;
    object-fit: contain;
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    will-change: transform;
    display: block;
    margin: 0 auto;
    transform-style: preserve-3d;
    backface-visibility: hidden;
  }

  .card h3 {
    margin: 0.5rem;
    text-align: center;
    font-size: 1rem;
    text-shadow: 0 0 5px rgba(0,0,0,0.7);
    transition: transform 0.5s ease;
  }

  .card:hover {
    transform: scale(1.05);
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    filter: brightness(1.1);
  }

  /* 3D Tilt Effect เมื่อ hover */
  .card:hover .card-inner {
    transform: rotateY(10deg) rotateX(-5deg);
  }

  /* เงาสะท้อน 3D */
  .card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.5s ease;
    border-radius: 16px;
    pointer-events: none;
  }

  .card:hover::after {
    opacity: 1;
  }

  @keyframes fadeInScale { 
    from { opacity: 0; transform: scale(0.8); } 
    to { opacity: 1; transform: scale(1); } 
  }

  /* Rarity Themes + Neon Glow */
  .card.common { background: linear-gradient(135deg, #7a7a7a, #5a5a5a); box-shadow: 0 0 15px rgba(122,122,122,0.6); }
  .card.uncommon { background: linear-gradient(135deg, #1eff00, #128f00); box-shadow: 0 0 20px rgba(30,255,0,0.7); }
  .card.rare { background: linear-gradient(135deg, #0070dd, #004c99); box-shadow: 0 0 25px rgba(0,112,221,0.8); }
  .card.epic { background: linear-gradient(135deg, #a335ee, #7018b8); box-shadow: 0 0 30px rgba(163,53,238,0.8); }
  .card.legendary { background: linear-gradient(135deg, #ff8000, #b35900); box-shadow: 0 0 35px rgba(255,128,0,0.9); }
  .card.dark { background: linear-gradient(135deg, #4b0082, #2c0050); box-shadow: 0 0 35px rgba(75,0,130,0.9); }
  .card.dc { background: linear-gradient(135deg, #0054a5, #003366); box-shadow: 0 0 35px rgba(0,84,165,0.9); }
  .card.evil { background: linear-gradient(135deg, #8b0000, #600000); box-shadow: 0 0 35px rgba(139,0,0,0.9); }
  .card.frozen { background: linear-gradient(135deg, #87ceeb, #4682b4); box-shadow: 0 0 35px rgba(135,206,235,0.9); }
  .card.gaming { background: linear-gradient(135deg, #9400d3, #4b0082); box-shadow: 0 0 35px rgba(148,0,211,0.9); }
  .card.lava { background: linear-gradient(135deg, #ff4500, #cc3700); box-shadow: 0 0 35px rgba(255,69,0,0.9); }
  .card.marvel { background: linear-gradient(135deg, #b22222, #8b0000); box-shadow: 0 0 35px rgba(178,34,34,0.9); }
  .card.minecraft { background: linear-gradient(135deg, #00aa00, #007700); box-shadow: 0 0 35px rgba(0,170,0,0.9); }
  .card.shadow { background: linear-gradient(135deg, #483d8b, #2f2554); box-shadow: 0 0 35px rgba(72,61,139,0.9); }
  .card.slurp { background: linear-gradient(135deg, #00ccff, #0088cc); box-shadow: 0 0 35px rgba(0,204,255,0.9); }
  .card.starwars { background: linear-gradient(135deg, #000, #222); box-shadow: 0 0 35px rgba(255,215,0,0.9); }

  /* Floating background items - parallax layers */
  .floating-item {
    position: absolute;
    width: 50px;
    height: 50px;
    opacity: 0.3;
    pointer-events: none;
    animation: floatUp linear infinite;
    will-change: transform, opacity;
    filter: blur(0);
    transition: transform 0.2s ease;
  }
  .layer1 { animation-duration: 20s; filter: blur(0px); }
  .layer2 { animation-duration: 35s; filter: blur(1.5px); }
  .layer3 { animation-duration: 50s; filter: blur(3px); }

  @keyframes floatUp { 
    0% { transform: translateY(100vh) rotate(0deg); } 
    100% { transform: translateY(-100px) rotate(360deg); } 
  }

  /* Loading animation */
  .loader {
    display: flex;
    justify-content: center;
    padding: 2rem;
  }
  
  .loader .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    border-top: 4px solid #00ffe7;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Load more button */
  .load-more {
    display: block;
    margin: 20px auto;
    padding: 12px 24px;
    background: linear-gradient(135deg, #00ffe7, #0084ff);
    color: #000;
    border: none;
    border-radius: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(0, 255, 231, 0.5);
  }
  
  .load-more:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px rgba(0, 255, 231, 0.8);
  }
  
  .load-more:active {
    transform: translateY(0);
  }

  /* No results message */
  .no-results {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: #888;
    font-style: italic;
  }

  @media (max-width: 768px) {
    h1 { font-size: 1.5rem; }
    .controls { flex-direction: column; }
    .card:hover .card-inner {
      transform: none;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
    }
  }

</style>
</head>
<body>
<header>
  <h1><i class="fas fa-store"></i> Fortnite Item Shop</h1>
</header>
<div class="controls">
  <div class="search-container">
    <i class="fas fa-search"></i>
    <input type="text" id="search" placeholder="Search items...">
  </div>
  <select id="typeFilter">
    <option value="">All Types</option>
    <option value="outfit">Outfit</option>
    <option value="backpack">Backpack</option>
    <option value="pickaxe">Pickaxe</option>
    <option value="emote">Emote</option>
    <option value="glider">Glider</option>
  </select>
</div>
<div class="grid" id="grid">
  <div class="loader">
    <div class="spinner"></div>
  </div>
</div>
<button class="load-more" id="loadMore" style="display: none;">
  <i class="fas fa-chevron-down"></i> Load More
</button>

<script>
const grid = document.getElementById('grid');
const searchInput = document.getElementById('search');
const typeFilter = document.getElementById('typeFilter');
const loadMoreBtn = document.getElementById('loadMore');

let allItems = [];
let filteredItems = [];
let displayedCount = 0;
const itemsPerLoad = 20;

async function fetchItems() {
  try {
    grid.innerHTML = '<div class="loader"><div class="spinner"></div></div>';
    const res = await fetch("https://fortnite-api.com/v2/cosmetics/br");
    const data = await res.json();
    allItems = data.data.filter(i=>i.images?.icon);
    filteredItems = allItems;
    grid.innerHTML = '';
    displayedCount = 0;
    loadMoreItems();
    createFloatingItems();
    
    if (filteredItems.length > itemsPerLoad) {
      loadMoreBtn.style.display = 'block';
    }
  } catch(err) {
    console.error("Failed to fetch", err);
    grid.innerHTML = "<p style='color:red;text-align:center;'>Failed to fetch data from Fortnite API.</p>";
  }
}

function loadMoreItems() {
  const slice = filteredItems.slice(displayedCount, displayedCount + itemsPerLoad);
  
  if (slice.length === 0) {
    if (displayedCount === 0) {
      grid.innerHTML = '<div class="no-results">No items found matching your criteria.</div>';
    }
    loadMoreBtn.style.display = 'none';
    return;
  }
  
  slice.forEach(item => {
    const card = document.createElement('div');
    const rarityClass = getRarityClass(item.rarity?.value?.toLowerCase() || 'common');
    card.className = `card ${rarityClass}`;
    card.innerHTML = `
      <div class="card-inner">
        <img src="${item.images.icon}" alt="${item.name}">
        <h3>${item.name}</h3>
      </div>
    `;
    
    card.addEventListener('mousemove', e => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      const rotateY = ((x - centerX) / centerX) * 10;
      const rotateX = ((centerY - y) / centerY) * 10;
      
      card.querySelector('.card-inner').style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
      
      const glowIntensity = Math.abs(rotateY) + Math.abs(rotateX);
      card.style.boxShadow = `0 ${glowIntensity * 2}px ${glowIntensity * 5}px rgba(0, 0, 0, 0.3)`;
    });
    
    card.addEventListener('mouseleave', e => {
      card.querySelector('.card-inner').style.transform = 'rotateY(0) rotateX(0)';
      card.style.boxShadow = '';
    });
    
    grid.appendChild(card);
  });
  displayedCount += itemsPerLoad;
  
  if (displayedCount >= filteredItems.length) {
    loadMoreBtn.style.display = 'none';
  }
}

function getRarityClass(rarity) {
  const rarityMap = {
    'common': 'common',
    'uncommon': 'uncommon',
    'rare': 'rare',
    'epic': 'epic',
    'legendary': 'legendary',
    'dark': 'dark',
    'dc': 'dc',
    'evil': 'evil',
    'frozen': 'frozen',
    'gaming': 'gaming',
    'lava': 'lava',
    'marvel': 'marvel',
    'minecraft': 'minecraft',
    'shadow': 'shadow',
    'slurp': 'slurp',
    'star wars': 'starwars'
  };
  
  return rarityMap[rarity] || 'common';
}

function filterItems() {
  const search = searchInput.value.toLowerCase();
  const type = typeFilter.value;
  filteredItems = allItems.filter(item =>
    (!search || item.name.toLowerCase().includes(search)) &&
    (!type || item.type.value === type)
  );
  grid.innerHTML = '';
  displayedCount = 0;
  loadMoreItems();
  
  if (filteredItems.length > itemsPerLoad) {
    loadMoreBtn.style.display = 'block';
  } else {
    loadMoreBtn.style.display = 'none';
  }
}

searchInput.addEventListener('input', filterItems);
typeFilter.addEventListener('change', filterItems);
loadMoreBtn.addEventListener('click', loadMoreItems);

function createFloatingItems() {
  const layers = ['layer1','layer2','layer3'];
  for(let i=0;i<30;i++){
    const item = document.createElement('img');
    const randomItem = allItems[Math.floor(Math.random()*allItems.length)];
    item.src = randomItem.images.icon;
    const layer = layers[i%layers.length];
    item.className = `floating-item ${layer}`;
    item.style.left = Math.random()*100+'vw';
    item.style.width = 20+Math.random()*50+'px';
    item.style.animationDuration = 10 + Math.random()*20+'s';
    item.style.animationDelay = Math.random()*10+'s';
    document.body.addEventListener('mousemove', e => {
      const offsetX = (window.innerWidth/2 - e.clientX)/100;
      const offsetY = (window.innerHeight/2 - e.clientY)/100;
      item.style.transform = `translateY(${offsetY}px) translateX(${offsetX}px)`;
    });
    document.body.appendChild(item);
  }
}

fetchItems();
</script>
</body>
</html>
