<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>API Tester</title>
<style>
  *, *::before, *::after {
    box-sizing: border-box;
  }
  html, body {
    margin:0; padding:0; height:100%;
    background: #fafafa;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .wrapper {
    width: 100%;
    max-width: 480px;
    background: #fff;
    padding: 2rem 2.5rem 3rem 2.5rem;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
  }
  input[type="text"] {
    font-size: 1.1rem;
    padding: 12px 16px;
    border: 2px solid #0078d4;
    border-radius: 8px;
    outline-offset: 2px;
    transition: border-color 0.3s ease;
    width: 100%;
    font-weight: 600;
    color: #222;
  }
  input[type="text"]:focus {
    border-color: #004a9f;
    box-shadow: 0 0 6px #004a9f66;
  }
  button {
    padding: 12px 24px;
    background: #0078d4;
    border: none;
    border-radius: 8px;
    color: #fff;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 8px rgb(0 120 212 / 0.35);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover {
    background: #005a9e;
    box-shadow: 0 6px 14px rgb(0 90 158 / 0.45);
  }
  button:active {
    background: #004173;
  }
  .discord-link {
    margin-top: 0.5rem;
    text-align: center;
    font-weight: 700;
    font-size: 1.15rem;
    color: #5865f2;
    cursor: pointer;
    text-decoration: none;
    user-select: none;
    transition: color 0.25s ease;
  }
  .discord-link:hover {
    color: #4752c4;
  }
  .overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.75);
    display: flex;
    flex-direction: column;
    padding: 60px 30px 30px 30px;
    box-sizing: border-box;
    z-index: 9999;
    justify-content: flex-start;
    align-items: stretch;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
  }
  .overlay.active {
    opacity: 1;
    visibility: visible;
  }
  .close-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 28px;
    font-weight: 900;
    color: #fff;
    background: transparent;
    border: none;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
    z-index: 10000;
  }
  .close-btn:hover {
    color: #bbb;
  }
  .stats-bar {
    margin-bottom: 12px;
    font-size: 1rem;
    color: #ddd;
    display: flex;
    justify-content: flex-start; /* <-- ย้ายไปซ้าย */
    gap: 20px;
    font-family: monospace;
  }
  .loader {
    border: 5px solid #eee;
    border-top: 5px solid #0078d4;
    border-radius: 50%;
    width: 52px;
    height: 52px;
    animation: spin 0.85s linear infinite;
    margin: 40px auto 0 auto;
  }
  @keyframes spin {
    0% {transform: rotate(0deg);}
    100% {transform: rotate(360deg);}
  }
  .response-content {
    flex: 1;
    background: #fefefe;
    border-radius: 8px;
    padding: 20px;
    font-family: "Consolas", monospace;
    font-size: 1rem;
    color: #222;
    overflow-y: auto;
    white-space: pre-wrap;
    box-shadow: inset 0 0 12px #cbd5e0;
  }
  .status-bar {
    margin-top: 18px;
    display: flex;
    justify-content: space-between;
    font-weight: 700;
    font-size: 1.05rem;
    color: #0078d4;
  }
  .status-code, .ping {
    background: #dbeeff;
    padding: 7px 14px;
    border-radius: 8px;
    box-shadow: 0 0 8px #a6c8ff;
    min-width: 70px;
    text-align: center;
    color: #004a9f;
  }
  @media (max-width: 480px) {
    .wrapper {
      padding: 1.5rem 1.8rem 2.5rem 1.8rem;
    }
    button {
      font-size: 1rem;
      padding: 10px 18px;
    }
    input[type="text"] {
      font-size: 1rem;
      padding: 10px 14px;
    }
    .close-btn {
      font-size: 24px;
      top: 12px;
      right: 12px;
    }
    .discord-link {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>

<div class="wrapper" role="main" aria-label="API Testing Interface">
  <input id="api-url" type="text" placeholder="Enter API URL here..." autocomplete="off" spellcheck="false" aria-label="API URL input" />
  <button id="test-api" aria-label="Test API Button">Test</button>
  <a href="https://discord.com/invite/mNGeUVcjKB" target="_blank" rel="noopener" class="discord-link" aria-label="Join Discord Server">Discord</a>
</div>

<div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="overlayTitle" aria-describedby="overlayDesc">
  <button class="close-btn" title="Close Overlay" aria-label="Close overlay">&times;</button>

  <div class="stats-bar" id="stats-bar">
    Lines: 0 | Characters: 0
  </div>

  <div id="loader" class="loader" aria-hidden="true"></div>
  <pre class="response-content" id="response-full" tabindex="0" aria-live="polite" aria-atomic="true"></pre>
  <div class="status-bar" aria-live="polite">
    <div class="status-code" id="status-code">Status: --</div>
    <div class="ping" id="ping-time">Ping: -- ms</div>
  </div>
</div>

<script>
  const btn = document.getElementById('test-api');
  const input = document.getElementById('api-url');
  const overlay = document.getElementById('overlay');
  const closeBtn = overlay.querySelector('.close-btn');
  const responseFull = document.getElementById('response-full');
  const statusCodeEl = document.getElementById('status-code');
  const pingTimeEl = document.getElementById('ping-time');
  const loader = document.getElementById('loader');
  const statsBar = document.getElementById('stats-bar');

  function fetchWithTimeout(resource, options = {}) {
    const { timeout = 10000 } = options;
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    return fetch(resource, {
      ...options,
      signal: controller.signal
    }).finally(() => clearTimeout(id));
  }

  function updateStats(text) {
    if (!text) {
      statsBar.textContent = 'Lines: 0 | Characters: 0';
      return;
    }
    const lines = text.split(/\r\n|\r|\n/).length;
    const chars = text.length;
    statsBar.textContent = `Lines: ${lines} | Characters: ${chars}`;
  }

  btn.onclick = async () => {
    const url = input.value.trim();
    if (!url) {
      alert('⚠️ Please enter a valid API URL.');
      return;
    }
    overlay.classList.add('active');
    loader.style.display = 'block';
    responseFull.style.display = 'none';
    statusCodeEl.parentElement.style.display = 'none';
    updateStats('');

    try {
      const start = performance.now();
      const res = await fetchWithTimeout(url, { timeout: 10000 });
      const end = performance.now();
      const ping = Math.round(end - start);

      statusCodeEl.textContent = `Status: ${res.status}`;
      pingTimeEl.textContent = `Ping: ${ping} ms`;

      const contentType = res.headers.get('content-type') || '';
      let text;
      if (contentType.includes('application/json')) {
        const json = await res.json();
        text = JSON.stringify(json, null, 2);
      } else {
        text = await res.text();
      }

      loader.style.display = 'none';
      responseFull.textContent = text;
      responseFull.style.display = 'block';
      statusCodeEl.parentElement.style.display = 'flex';
      updateStats(text);

    } catch (err) {
      loader.style.display = 'none';
      responseFull.textContent = '❌ Error: ' + (err.name === 'AbortError' ? 'Request timed out after 10 seconds.' : err.message);
      responseFull.style.display = 'block';
      statusCodeEl.textContent = 'Status: ERROR';
      pingTimeEl.textContent = 'Ping: -- ms';
      statusCodeEl.parentElement.style.display = 'flex';
      updateStats('');
    }
  };

  closeBtn.onclick = () => {
    overlay.classList.remove('active');
  };

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && overlay.classList.contains('active')) {
      overlay.classList.remove('active');
    }
  });
</script>

</body>
</html>
