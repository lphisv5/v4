<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Search & Player - All-in-One System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ff0000;
      --primary-dark: #cc0000;
      --secondary: #282828;
      --accent: #606060;
      --danger: #ff3333;
      --success: #00c853;
      --warning: #ffab00;
      --discord: #5865F2;
      --discord-dark: #4752C4;
      --bg-1: #0f0f0f;
      --bg-2: #181818;
      --bg-3: #212121;
      --bg-card: rgba(33, 33, 33, 0.9);
      --bg-glass: rgba(255, 255, 255, 0.08);
      --text: #ffffff;
      --text-muted: #aaaaaa;
      --text-light: #f1f1f1;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-full: 9999px;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
      --shadow-primary: 0 0 12px rgba(255, 0, 0, 0.3);
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-xxl: 48px;
      --font-sans: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, sans-serif;
      --font-mono: 'Roboto Mono', monospace;
      --max-width: 1400px;
      --header-height: 56px;
      --player-height: 360px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html { scroll-behavior: smooth; }
    body { min-height: 100vh; background: var(--bg-1); color: var(--text); font-family: var(--font-sans); line-height: 1.5; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    h1, h2, h3, h4, h5, h6 { font-weight: 500; line-height: 1.3; }
    h1 { font-size: 1.8rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.3rem; }
    h4 { font-size: 1.1rem; }
    h5 { font-size: 1rem; }
    h6 { font-size: 0.9rem; }
    @media (max-width: 768px) { h1 { font-size: 1.5rem; } h2 { font-size: 1.3rem; } h3 { font-size: 1.1rem; } }
    p { margin-bottom: var(--space-md); font-size: 0.95rem; }
    a { color: var(--text-light); text-decoration: none; transition: all 0.2s; }
    a:hover { color: var(--primary); }
    .container { width: 100%; max-width: var(--max-width); margin: 0 auto; padding: 0 var(--space-md); }
    header { position: sticky; top: 0; z-index: 100; background: var(--bg-2); height: var(--header-height); display: flex; align-items: center; padding: 0 var(--space-md); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .header-container { display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: var(--max-width); margin: 0 auto; }
    .logo { display: flex; align-items: center; gap: var(--space-sm); font-weight: 500; font-size: 1.2rem; }
    .logo-icon { color: var(--primary); font-size: 1.5rem; }
    .app { display: grid; grid-template-columns: 1fr; min-height: calc(100vh - var(--header-height)); }
    .player-section { background: var(--bg-2); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .player-container { position: relative; width: 100%; height: var(--player-height); max-height: 70vh; background: #000; border-radius: var(--radius-md); overflow: hidden; }
    .player-placeholder { display: flex; align-items: center; justify-content: center; flex-direction: column; width: 100%; height: 100%; background: var(--bg-3); color: var(--text-muted); gap: var(--space-md); }
    .player-placeholder-icon { font-size: 3rem; color: var(--primary); }
    .player-iframe { width: 100%; height: 100%; border: none; }
    .player-info { margin-top: var(--space-md); }
    .player-title { font-size: 1.2rem; margin-bottom: var(--space-sm); }
    .player-meta { display: flex; align-items: center; gap: var(--space-md); color: var(--text-muted); font-size: 0.9rem; }
    .search-section { padding: var(--space-xl) 0; }
    .search-container { background: var(--bg-2); border-radius: var(--radius-lg); padding: var(--space-lg); border: 1px solid rgba(255, 255, 255, 0.1); }
    .search-header { margin-bottom: var(--space-lg); }
    .search-title { margin-bottom: var(--space-sm); }
    .search-description { color: var(--text-muted); font-size: 0.95rem; }
    .search-form { display: flex; gap: var(--space-md); }
    .search-input-container { flex: 1; position: relative; }
    .search-input { width: 100%; padding: var(--space-md) var(--space-md) var(--space-md) 44px; border-radius: var(--radius-md); border: 1px solid rgba(255, 255, 255, 0.1); background: var(--bg-3); color: var(--text); font-size: 1rem; transition: all 0.2s; }
    .search-input:focus { outline: none; border-color: var(--primary); box-shadow: var(--shadow-primary); }
    .search-icon { position: absolute; left: var(--space-md); top: 50%; transform: translateY(-50%); color: var(--text-muted); }
    .search-button { padding: 0 var(--space-lg); border-radius: var(--radius-md); background: var(--primary); color: white; border: none; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: var(--space-sm); }
    .search-button:hover { background: var(--primary-dark); transform: translateY(-1px); }
    .search-button:active { transform: translateY(0); }
    .results-section { padding-bottom: var(--space-xl); }
    .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); }
    .results-title { display: flex; align-items: center; gap: var(--space-sm); }
    .results-count { color: var(--text-muted); font-size: 0.9rem; }
    .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--space-lg); }
    .video-card { background: var(--bg-2); border-radius: var(--radius-md); overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; cursor: pointer; }
    .video-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: rgba(255, 255, 255, 0.2); }
    .video-thumbnail { width: 100%; height: 180px; position: relative; overflow: hidden; }
    .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
    .video-card:hover .video-thumbnail img { transform: scale(1.03); }
    .video-duration { position: absolute; bottom: var(--space-sm); right: var(--space-sm); background: rgba(0, 0, 0, 0.8); color: white; padding: 2px 6px; border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: 500; }
    .video-content { padding: var(--space-md); }
    .video-title { font-size: 1rem; margin-bottom: var(--space-sm); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
    .video-meta { display: flex; flex-direction: column; gap: var(--space-xs); font-size: 0.85rem; color: var(--text-muted); }
    .video-channel { display: flex; align-items: center; gap: var(--space-sm); }
    .channel-avatar { width: 24px; height: 24px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); }
    .loading-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-xxl) 0; gap: var(--space-md); }
    .spinner { width: 48px; height: 48px; border: 4px solid rgba(255, 255, 255, 0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { color: var(--text-muted); }
    .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-xxl) 0; gap: var(--space-md); text-align: center; }
    .empty-icon { font-size: 3rem; color: var(--text-muted); }
    .empty-text { color: var(--text-muted); max-width: 500px; }
    .error-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-xxl) 0; gap: var(--space-md); text-align: center; }
    .error-icon { font-size: 3rem; color: var(--danger); }
    .error-text { color: var(--danger); max-width: 500px; }
    .retry-button { padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); background: var(--primary); color: white; border: none; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: var(--space-sm); }
    .retry-button:hover { opacity: 0.9; }
    .load-more-button { padding: var(--space-md) var(--space-lg); border-radius: var(--radius-md); background: var(--primary); color: white; border: none; font-weight: 500; cursor: pointer; margin: var(--space-lg) auto; display: block; }
    .load-more-button:hover { background: var(--primary-dark); }
    footer { background: var(--bg-2); padding: var(--space-xl) 0; border-top: 1px solid rgba(255, 255, 255, 0.1); }
    .footer-container { display: flex; flex-direction: column; align-items: center; gap: var(--space-md); text-align: center; }
    .footer-links { display: flex; gap: var(--space-lg); flex-wrap: wrap; justify-content: center; align-items: center; }
    .footer-link { color: var(--text-muted); font-size: 0.9rem; transition: color 0.2s; }
    .footer-link:hover { color: var(--primary); }
    .discord-button { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm) var(--space-md); background: var(--discord); color: white; border-radius: var(--radius-md); font-size: 0.9rem; font-weight: 500; transition: all 0.2s; }
    .discord-button:hover { background: var(--discord-dark); transform: translateY(-1px); color: white; }
    .discord-button:active { transform: translateY(0); }
    .discord-button i { font-size: 1rem; }
    .footer-copyright { color: var(--text-muted); font-size: 0.85rem; }
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .text-muted { color: var(--text-muted); }
    .mt-sm { margin-top: var(--space-sm); }
    .mt-md { margin-top: var(--space-md); }
    .mt-lg { margin-top: var(--space-lg); }
    .mt-xl { margin-top: var(--space-xl); }
    .mb-sm { margin-bottom: var(--space-sm); }
    .mb-md { margin-bottom: var(--space-md); }
    .mb-lg { margin-bottom: var(--space-lg); }
    .mb-xl { margin-bottom: var(--space-xl); }
    @media (max-width: 1200px) { :root { --player-height: 320px; } }
    @media (max-width: 992px) { :root { --player-height: 280px; } }
    @media (max-width: 768px) {
      :root { --player-height: 240px; }
      .search-form { flex-direction: column; }
      .search-button { width: 100%; justify-content: center; padding: var(--space-md); }
      .results-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
      .footer-links { flex-direction: column; gap: var(--space-md); }
    }
    @media (max-width: 576px) {
      :root { --player-height: 200px; --space-xl: 24px; --space-lg: 20px; --space-md: 16px; }
      .results-grid { grid-template-columns: 1fr; }
      .video-thumbnail { height: 160px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-container">
        <div class="logo">
          <i class="fab fa-youtube logo-icon"></i>
          <span class="logo-text">YouTube Player</span>
        </div>
      </div>
    </div>
  </header>

  <main class="app">
    <section class="player-section">
      <div class="container">
        <div class="player-container" id="playerContainer">
          <div class="player-placeholder" id="playerPlaceholder">
            <i class="fab fa-youtube player-placeholder-icon"></i>
            <p>Select a video to start playing</p>
          </div>
          <iframe class="player-iframe hidden" id="playerIframe" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
        </div>
        <div class="player-info hidden" id="playerInfo">
          <h3 class="player-title" id="playerTitle"></h3>
          <div class="player-meta">
            <span id="playerChannel"></span>
            <span id="playerViews"></span>
          </div>
        </div>
      </div>
    </section>

    <section class="search-section">
      <div class="container">
        <div class="search-container">
          <div class="search-header">
            <h1 class="search-title">Search YouTube Videos</h1>
            <p class="search-description">Find and play videos instantly without leaving the site</p>
          </div>
          <form class="search-form" id="searchForm">
            <div class="search-input-container">
              <i class="fas fa-search search-icon"></i>
              <input type="search" class="search-input" id="searchInput" placeholder="Search for videos, e.g., 'Thai cooking tutorial'" aria-label="Search videos" autocomplete="off" required>
            </div>
            <button type="submit" class="search-button">
              <i class="fas fa-search"></i>
              <span>Search</span>
            </button>
          </form>
        </div>
      </div>
    </section>

    <section class="results-section">
      <div class="container">
        <div class="results-header">
          <div class="results-title">
            <h2 id="resultsTitle">Search Results</h2>
            <span class="results-count" id="resultsCount"></span>
          </div>
        </div>
        <div id="resultsContainer" aria-live="polite">
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-search"></i></div>
            <h3>Start Your Search</h3>
            <p class="empty-text">Enter a query in the search bar above to find YouTube videos</p>
          </div>
          <div class="loading-state hidden" id="loadingState">
            <div class="spinner"></div>
            <p class="loading-text">Searching for videos...</p>
          </div>
          <div class="error-state hidden" id="errorState">
            <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <h3>An Error Occurred</h3>
            <p class="error-text" id="errorText"></p>
            <button class="retry-button" id="retryButton">
              <i class="fas fa-sync-alt"></i>
              <span>Try Again</span>
            </button>
          </div>
          <div class="results-grid hidden" id="resultsGrid"></div>
          <button class="load-more-button hidden" id="loadMoreButton">Load More</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-container">
        <div class="footer-links">
          <a href="#" class="footer-link">About Us</a>
          <a href="#" class="footer-link">Privacy Policy</a>
          <a href="#" class="footer-link">Terms of Use</a>
          <a href="#" class="footer-link">Contact Us</a>
          <a href="https://discord.com/invite/mNGeUVcjKB" class="discord-button" target="_blank">
            <i class="fab fa-discord"></i>
            <span>Join Our Discord</span>
          </a>
        </div>
        <p class="footer-copyright">&copy; 2025 YouTube Player. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    const API_ENDPOINT = 'https://api.loopy5418.dev/yt-search';
    const DEFAULT_THUMBNAIL = 'https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg';
    const MAX_RETRIES = 3;
    const RETRY_DELAY = 2000;

    // DOM Elements
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');
    const playerContainer = document.getElementById('playerContainer');
    const playerPlaceholder = document.getElementById('playerPlaceholder');
    const playerIframe = document.getElementById('playerIframe');
    const playerInfo = document.getElementById('playerInfo');
    const playerTitle = document.getElementById('playerTitle');
    const playerChannel = document.getElementById('playerChannel');
    const playerViews = document.getElementById('playerViews');
    const resultsContainer = document.getElementById('resultsContainer');
    const resultsGrid = document.getElementById('resultsGrid');
    const resultsTitle = document.getElementById('resultsTitle');
    const resultsCount = document.getElementById('resultsCount');
    const loadingState = document.getElementById('loadingState');
    const errorState = document.getElementById('errorState');
    const errorText = document.getElementById('errorText');
    const retryButton = document.getElementById('retryButton');
    const loadMoreButton = document.getElementById('loadMoreButton');

    // App State
    let currentQuery = '';
    let currentVideo = null;
    let searchResults = [];
    let nextPageToken = '';
    const cache = new Map();

    // Initialize the app
    function init() {
      console.log('Initializing app...');
      setupEventListeners();
      performSearch('example');
    }

    // Set up event listeners
    function setupEventListeners() {
      searchForm.addEventListener('submit', handleSearch);
      retryButton.addEventListener('click', retrySearch);
      loadMoreButton.addEventListener('click', () => performSearch(currentQuery, nextPageToken));
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });
      searchInput.addEventListener('input', debounce((e) => {
        const query = e.target.value.trim();
        if (query) {
          currentQuery = query;
          performSearch(query);
        }
      }, 500));
    }

    // Debounce function
    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Handle search form submission
    async function handleSearch(e) {
      e.preventDefault();
      const query = searchInput.value.trim();
      if (!query) return;
      currentQuery = query;
      console.log('Searching for:', query);
      performSearch(query);
    }

    // Perform the actual search with retry logic
    async function performSearch(query, pageToken = '', retryCount = 0) {
      const cacheKey = `${query}:${pageToken}`;
      if (cache.has(cacheKey)) {
        console.log('Using cached results for:', cacheKey);
        processResults(cache.get(cacheKey));
        return;
      }
      try {
        showLoading();
        const url = new URL(API_ENDPOINT);
        url.searchParams.set('query', query);
        if (pageToken) url.searchParams.set('pageToken', pageToken);
        console.log('Fetching from:', url.toString());
        const response = await fetch(url.toString(), {
          method: 'GET',
          headers: { 'Accept': 'application/json' }
        });
        if (!response.ok) {
          let errorMessage = 'An error occurred during the search';
          if (response.status === 400) {
            errorMessage = 'Bad request. Please check the query or contact the administrator.';
          } else if (response.status === 401) {
            errorMessage = 'Unauthorized access. API key may be invalid.';
          } else if (response.status === 429) {
            if (retryCount < MAX_RETRIES) {
              console.log(`Rate limit exceeded, retrying (${retryCount + 1}/${MAX_RETRIES})...`);
              await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));
              return performSearch(query, pageToken, retryCount + 1);
            }
            errorMessage = 'Rate limit exceeded. Please try again later.';
          } else {
            errorMessage = `HTTP error! status: ${response.status}`;
          }
          const errorData = await response.text();
          console.error('Error response:', errorData);
          throw new Error(errorMessage);
        }
        const data = await response.json();
        console.log('API response:', data);
        cache.set(cacheKey, data);
        processResults(data);
      } catch (error) {
        console.error('Search error:', error);
        showError(error.message);
      }
    }

    // Process API results
    function processResults(data) {
      searchResults = nextPageToken ? searchResults : [];
      nextPageToken = data.nextPageToken || '';
      if (!data || data.success === false || (Object.keys(data).length === 0 && !Array.isArray(data))) {
        console.log('No results or invalid response:', data);
        showEmptyResults();
        return;
      }
      const newResults = Array.isArray(data) ? data : Object.values(data).filter(item => item && item.title && item !== true);
      if (newResults.length === 0) {
        showEmptyResults();
        return;
      }
      newResults.forEach(item => {
        searchResults.push({
          id: item.videoId || item.id,
          title: item.title || 'No video title',
          channel: item.channel || 'Unknown channel',
          thumbnail: item.thumbnail || DEFAULT_THUMBNAIL,
          link: item.link || `https://www.youtube.com/watch?v=${item.videoId || item.id}`,
          views: item.views || 'Unknown views',
          duration: item.duration || '--:--'
        });
      });
      console.log('Processed results:', searchResults);
      displayResults();
      loadMoreButton.classList.toggle('hidden', !nextPageToken);
    }

    // Display search results
    function displayResults() {
      resultsTitle.textContent = `Results for "${currentQuery}"`;
      resultsCount.textContent = `${searchResults.length} videos`;
      resultsGrid.innerHTML = '';
      searchResults.forEach(video => {
        const videoCard = createVideoCard(video);
        resultsGrid.appendChild(videoCard);
      });
      showResults();
      if (!currentVideo && searchResults.length > 0) {
        playVideo(searchResults[0]);
      }
    }

    // Create a video card element
    function createVideoCard(video) {
      const card = document.createElement('div');
      card.className = 'video-card';
      card.dataset.videoId = video.id;
      card.innerHTML = `
        <div class="video-thumbnail">
          <img src="${escapeHtml(video.thumbnail)}" alt="${escapeHtml(video.title)}" loading="lazy">
          <span class="video-duration">${escapeHtml(video.duration)}</span>
        </div>
        <div class="video-content">
          <h3 class="video-title">${escapeHtml(video.title)}</h3>
          <div class="video-meta">
            <div class="video-channel">
              <div class="channel-avatar"></div>
              <span>${escapeHtml(video.channel)}</span>
            </div>
            <span>${escapeHtml(video.views)}</span>
          </div>
        </div>
      `;
      card.addEventListener('click', () => playVideo(video));
      return card;
    }

    // Play a video in the player
    function playVideo(video) {
      currentVideo = video;
      const embedUrl = `https://www.youtube.com/embed/${video.id}?autoplay=1&rel=0`;
      playerIframe.src = embedUrl;
      playerIframe.classList.remove('hidden');
      playerPlaceholder.classList.add('hidden');
      playerTitle.textContent = video.title;
      playerChannel.textContent = video.channel;
      playerViews.textContent = video.views;
      playerInfo.classList.remove('hidden');
      if (window.innerWidth < 768) {
        playerContainer.scrollIntoView({ behavior: 'smooth' });
      }
      highlightSelectedVideo(video.id);
    }

    // Highlight the selected video card
    function highlightSelectedVideo(videoId) {
      const allCards = document.querySelectorAll('.video-card');
      allCards.forEach(card => {
        if (card.dataset.videoId === videoId) {
          card.style.borderColor = 'var(--primary)';
          card.style.boxShadow = 'var(--shadow-primary)';
        } else {
          card.style.borderColor = 'rgba(255, 255, 255, 0.1)';
          card.style.boxShadow = 'none';
        }
      });
    }

    // Retry the last search
    function retrySearch() {
      if (currentQuery) {
        performSearch(currentQuery);
      }
    }

    // Show loading state
    function showLoading() {
      loadingState.classList.remove('hidden');
      errorState.classList.add('hidden');
      resultsGrid.classList.add('hidden');
      loadMoreButton.classList.add('hidden');
    }

    // Show results
    function showResults() {
      loadingState.classList.add('hidden');
      errorState.classList.add('hidden');
      resultsGrid.classList.remove('hidden');
    }

    // Show error state
    function showError(message) {
      errorText.textContent = message;
      loadingState.classList.add('hidden');
      errorState.classList.remove('hidden');
      resultsGrid.classList.add('hidden');
      loadMoreButton.classList.add('hidden');
    }

    // Show empty results state
    function showEmptyResults() {
      loadingState.classList.add('hidden');
      errorState.classList.add('hidden');
      resultsGrid.classList.add('hidden');
      loadMoreButton.classList.add('hidden');
      const emptyState = document.querySelector('.empty-state');
      if (emptyState) {
        emptyState.querySelector('h3').textContent = 'No Results Found';
        emptyState.querySelector('.empty-text').textContent = 'No videos match your search. Try a different query.';
      }
    }

    // Helper function to escape HTML
    function escapeHtml(unsafe) {
      if (!unsafe) return '';
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
